#!/bin/sh

MIXER=`sed 's/,.*//' /tmp/mixer_control_cache`

NAME=`hostname`_`ifconfig eth0 | awk '/inet addr/{print substr($2,6)}'`
OPTIONS="-z -D 1000:u32le -r 44100-22579200:1000 -a 400:3::0 -M $NAME"

start() {
        printf "Starting Squeezelite: "
	/usr/bin/squeezelite $OPTIONS
        sleep 0.1
        pid=$(pidof squeezelite)
        if [ -n "$pid" ]; then
        renice -15 $pid
        for tid in $(ls /proc/$pid/task/); do
            renice -15 $tid
        done
        fi
        [ -n "$MIXER" ] && /usr/bin/amixer set "$MIXER" unmute 2>/dev/null
    }
stop() {
    [ -n "$MIXER" ] && /usr/bin/amixer set "$MIXER" mute 2>/dev/null
    killall -9 squeezelite
}
restart() {
	stop
	start
}
case "$1" in
  start|stop|restart)
	"$1"
	;;
  *)
	echo "Usage: $0 {start|stop|restart}"
	exit 1
esac

exit $?
